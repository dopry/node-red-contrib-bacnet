
<script type="text/x-red" data-template-name="bacnet-subscribe">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-address"><i class="icon-bookmark"></i> Address</label>
        <input type="text" id="node-input-address" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-objectType"><i class="icon-bookmark"></i> Object Type</label>
        <select id="node-input-objectType" placeholder=""></select>
    </div>
    <div class="form-row">
        <label for="node-input-objectInstance"><i class="icon-bookmark"></i> Object Instance</label>
        <input type="text" id="node-input-objectInstance" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-arrayIndex"><i class="icon-bookmark"></i> Subscribe ID</label>
        <input type="text" id="node-input-subscribeId" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-arrayIndex"><i class="icon-bookmark"></i> Issue confirmed notifications</label>
        <input type="checkbox" id="node-input-issueConfirmedNotifications" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-arrayIndex"><i class="icon-bookmark"></i> Lifetime</label>
        <input type="text" id="node-input-lifetime" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-bacnetInterface"><i class="icon-globe"></i> Server</label>
        <input type="text" id="node-input-bacnetInterface">
    </div>
</script>

<script type="text/x-red" data-help-name="bacnet-subscribe">
    <p>The <code>subscribeCOV</code> command subscribes to a specified objects changes. It accepts an input whose device property will override the properties set here.</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>address <span class="property-type">string</span></dt>
        <dd>IP address of the target device.</dd>
        <dt>objectType <span class="property-type">number | bacstack.enum.ObjectTypes</span></dt>
        <dd>The BACNET object type to read.</dd>
        <dt>objectInstance <span class="property-type">number</span></dt>
        <dd>The BACNET object instance to read.</dd>
        <dt>subscribeId <span class="property-type">number</span></dt>
        <dd>Subscription identifier, unique per subscription</dd>
        <dt>issueConfirmedNotifications <span class="property-type">boolean</span></dt>
        <dd>Controls whether the the subscription uses confirmations.</dd>
        <dt>lifetime <span class="property-type">number</span></dt>
        <dd>Subscription lifetime in seconds.</dd>
    </dl>
    <h3>Outputs</h3>
    <h4>TBD</h4>
</script>

<script type="text/javascript">
    RED.nodes.registerType('bacnet-subscribe', {
        category: 'BACnet',
        color: '#E9967A',
        defaults: {
            address: {
                value: '',
                required: false
            },
            objectType: {
                value: '',
                required: false,
                validate: RED.validators.number()
            },
            objectInstance: {
                value: '',
                required: false,
                validate: RED.validators.number()
            },
            subscribeId: {
                value: '',
                required: false,
                validate: RED.validators.number()
            },
            issueConfirmedNotifications: {
                value: false,
                required: false,
            },
            lifetime: {
                value: 0,
                required: false,
                validate: RED.validators.number()
            },
            bacnetInterface: {
                type: 'bacnet-interface'
            }
        },
        inputs: 0,
        outputs: 1,
        icon: 'bacnet-icon.png',
        paletteLabel: 'Subscribe',
        label: function() {
            return (this.name || 'Subscribe');
        },
        oneditprepare: function() {
            let self = this;
            $.getJSON('/bacnet/ObjectTypes', function(options) {
                let select = document.getElementById('node-input-objectType');
                options.forEach(element => {
                    let option = document.createElement("option");
                    option.value = element.value;
                    option.label = element.label;
                    select.add(option);
                });
                select.value = self.objectType;
            });
        }
    });
</script>
