<script type="text/x-red" data-template-name="bacnet-read-multiple">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-address"><i class="icon-bookmark"></i> Address</label>
        <input type="text" id="node-input-address" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-bacnetInterface"><i class="icon-globe"></i> Server</label>
        <input type="text" id="node-input-bacnetInterface">
    </div>
</script>

<script type="text/x-red" data-help-name="bacnet-read-multiple">
    <p>The <code>readPropertyMultiple</code> command reads multiple properties from multiple device objects. It accepts address which can be override by input.</p>
    <p>This node expects input to provide <code>requestyArray</code> property with the target read fields.</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>objectIdentifier <span class="property-type">object</span></dt>
        <dd>
            <span>Specific object to read.</span>
            <dl class="message-properties">
                <dt>type <span class="property-type">number</span></dt>
                <dd>Bacnet object type to read</dd>
                <dt>instance <span class="property-type">number</span></dt>
                <dd>Bacnet object instance to read.</dd>
            </dl>
        </dd>
        <dt>propertyReferences <span class="property-type">Array&lt;object&gt;</span></dt>
        <dd>
            <span>List of properties to read.</span>
            <dl class="message-properties">
                <dt>propertyIdentifier <span class="property-type">number</span></dt>
                <dd>Bacnet property id to read. Supports 8 for all properties.</dd>
            </dl>
        </dd>
    </dl>
</script>

<script type="text/javascript">
    RED.nodes.registerType('bacnet-read-multiple', {
        category: 'BACnet',
        color: '#E9967A',
        defaults: {
            address: {
                value: '',
                required: false
            },
            bacnetInterface: {
                value: '',
                type: 'bacnet-interface'
            }
        },
        inputs: 1,
        outputs: 1,
        icon: 'bacnet-icon.png',
        paletteLabel: 'Read Multiple',
        label: function() {
            return (this.name || 'Read Multiple');
        },
        oneditprepare: function() {
            let self = this;
            $.getJSON('/bacnet/ObjectTypes', function(options) {
                let select = document.getElementById('node-input-objectType');
                options.forEach(element => {
                    let option = document.createElement("option");
                    option.value = element.value;
                    option.label = element.label;
                    select.add(option);
                });
                select.value = self.objectType;
            });

            $.getJSON('/bacnet/PropertyIds', (options) => {
                let select = document.getElementById('node-input-propertyId');
                console.log('options', options);
                options.forEach(element => {
                    let option = document.createElement("option");
                    option.value = element.value;
                    option.label = element.label;
                    select.add(option);
                });
                select.value = self.propertyId;
            });      
        }
    });
</script>

